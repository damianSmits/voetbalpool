<!doctype html>

<html lang="nl">
    <head>
        <meta charset="utf-8">
		
        <title>Foebelpooltje</title>
        <meta name="description" content="The foebel pool for the whole family">
        <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

    </head>

    <header id="mainheader" class="header">
        
    </header>


    <body>
        
        <div id = "app">
            <!-- <links 
            v-on:admin-confirmed="goToAdmin">
            </links> -->
            <admin-screen
            v-on:team-confirmed="addTeam"
            v-on:match-confirmed="addMatch"
            v-on:show-matches="getMatches"
            ></br></br>
            
            
        </admin-screen>
                
            
            

        </div>
        
        <script>
        Vue.component('admin-screen', {
            data() {
                return {
                    teamName: undefined,
                    homeTeam: "",
                    awayTeam:"",
                    awayGoals:"",
                    homeGoals:"",
                    round:0,
                    roundThatHasBeen:0,
                    errorMessage: "",
                }
            },
            template: `
                <div>
                    
                    Voeg Team toe
                    </br><input placeholder = 'naam' v-model="teamName"/>
                   
                    </br><button v-on:click="confirmTeam">Stort</button>
                    </br>{{ errorMessage }}
                    </br></br>

                    Kan ook wel wedstrijd toevoegen als je wilt
                    </br><input placeholder = 'Thuisteam' v-model="homeTeam"/>
                    </br><input placeholder = 'Uitteam' v-model="awayTeam"/>
                    </br><input placeholder = 'Speelronde' v-model="round" min = 0 step =1/>Speelronde
                    </br><button v-on:click="confirmMatch">Stort</button>
                    {{ errorMessage }}
                    </br></br>

                    Of missschien uitslagen invullen van speelronde:
                    </br><input placeholder = 'round' v-model="roundThatHasBeen" min = 0 step =1/>
                    </br><button v-on:click="showMatches">Laat zien dan</button>
                    {{ errorMessage }}

                    <div id="list"></div>
                    <template>
                        <article>
                        <span class = "hometeam">thuis</span>
                        <input v-model="homeGoals" min = 0 step =1 size = 4/>
                        -
                        <input v-model="awayGoals" min = 0 step =1 size = 4/>
                        <span class = "awayteam">uit</span>
                        <button class="matchResult" v-on:click="matchResultClicked">stort</button> 
                        </article>
                    
                        
                    </template>

                    </div>
                    
            `,
            methods: {
                confirmTeam() {
                    if (!this.teamName) {
                        this.errorMessage = "wel teamNaam toevoegen";
                        return;
                    }

                    this.errorMessage = "";
                    this.$emit('team-confirmed', this.teamName);                 
                },
                confirmMatch() {
                    if (!this.homeTeam || !this.awayTeam) {
                        this.errorMessage = "wel teamNaam toevoegen";
                        return;
                    }

                    this.errorMessage = "";
                    this.$emit('match-confirmed', this.homeTeam, this.awayTeam, this.round);                 
                },
                showMatches() {
                    if (!this.roundThatHasBeen) {
                        this.errorMessage = "wel speelronde toevoegen";
                        return;
                    }
                    this.errorMessage = "";
                    this.$emit('show-matches', this.roundThatHasBeen);

                }
            }
        });

        Vue.component('links', {
            data() {
                return {
                }
            },
            template: `
                <div>
                    <button v-on:click="adminRights">admin</button>   
                </div>
                    
            `,
            methods: {   
                adminRights(){
                    this.$emit('admin-confirmed'); 
                }
            }
         });
        

    const app = new Vue({
        el: '#app',

        data: {
            haveAdminRights: false,
            matches:[] 
        },

        computed: {
            goToAdmin(){
            return !this.haveAdminRights;  
            }
        },
        methods: {
            async addTeam(teamName){
                console.log(teamName);
                let newTeam = {"teamName": teamName}
                await fetch('api/addTeam', {
                    method: 'POST',
                    headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(newTeam)  
                })
            },
            async addMatch(homeTeam, awayTeam, round){
                console.log(homeTeam + "" + awayTeam + "" + round);
                let newMatch = {
                    "homeTeam": homeTeam,
                    "awayTeam": awayTeam,
                    "round": round
            }
                await fetch('api/addMatch', {
                    method: 'POST',
                    headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(newMatch)  
                })
            },
            async getMatches(roundThatHasBeen){
                console.log(roundThatHasBeen);
                let newRoundThatHasBeen= {"round": roundThatHasBeen}
                let response = await fetch('api/showMatch/', {
                    method: 'POST',
                    headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(newRoundThatHasBeen) 
                })
                matches = await response.json();
                console.log(matches);
                console.log(matches.length)
                for (let i = 0; i < matches.length; i++) {
                    let temp = document.getElementsByTagName("template")[0];
                    let clone = temp.content.cloneNode(true);
                    let article = clone.querySelector("article");
                    article.children[0].innerHTML=matches[i].homeTeam;
                    article.children[3].innerHTML=matches[i].awayTeam;
                    document.getElementById("list").appendChild(article);
                };
            },
            async matchResultClicked(){
                console.log("D:")
            }
        },
    })

                
    </script>
        
      
           
        
        

    <script src="src/foebelIndex.js"></script>

    </body>
</html>

