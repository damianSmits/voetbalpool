<!doctype html>

<html lang="nl">
    <head>
        <meta charset="utf-8">
		
        <title>Foebelpooltje</title>
        <meta name="description" content="The foebel pool for the whole family">
        <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

    </head>

    <header id="mainheader" class="header">  
    </header>
    <body>
        
        <div id = "app">
            <links 
            v-on:admin-confirmed="goToAdmin"
            v-on:get-played-matches="getPlayedMatches"
            v-on:show-played-matches="showPlayedMatchespls"
            v-on:show-register-user="goToRegister"
            v-on:show-user-login="goToLogin"
            v-on:show-matches-to-predict="goToPredictMatches">
            </links>

            <admin-screen
            v-if=haveAdminRights
            v-on:team-confirmed="addTeam"
            v-on:match-confirmed="addMatch"
            v-on:show-matches="getMatchesToGiveResult"
            >
            </admin-screen>      
        
            <matches-screen
                v-if=showPlayed
                v-bind:played-matches=playedMatches
                >
            </matches-screen>

            <fill-in-results-screen
                v-if=showMatchesForResult
                v-bind:matches=matches
                v-on:give-results-to-matches="sendResults">
            </fill-in-results-screen>
        
            <register-screen
                v-if=showRegisterForm
                v-on:register-user="registerUser">
            </register-screen>

            <login-screen
                v-if=showUserLogin
                v-on:user-login="userLogin">
            </login-screen>
            
            <predict-screen
                v-if=predictMatches
                v-on:predict-matches="showMatchesToPredict"
                v-bind:matches-to-predict="matchesToPredict"
                v-on:send-prediction="sendMatchPrediction">
            </predict-screen>

        </div>
        <script>
        Vue.component('admin-screen', {
            props: [ 'matches' ],
            data() {
                return {
                    teamName: undefined,
                    homeTeam:"",
                    awayTeam:"",
                    awayGoals:"",
                    homeGoals:"",
                    round:0,
                    roundThatHasBeen:0,
                    errorMessage: "",
                }
            },
            
            template: `
                <div>
                    </br> {{ errorMessage }}</br>
                    Voeg Team toe
                    </br><input placeholder = 'naam' v-model="teamName"/>
                   
                    </br><button v-on:click="confirmTeam">Stort</button>
                    </br>
                    </br></br>

                    Kan ook wel wedstrijd toevoegen als je wilt
                    </br><input placeholder = 'Thuisteam' v-model="homeTeam"/>
                    </br><input placeholder = 'Uitteam' v-model="awayTeam"/>
                    </br><input placeholder = 'Speelronde' v-model="round" min = 0 step =1/>Speelronde
                    </br><button v-on:click="confirmMatch">Stort</button>
                    
                    </br></br>

                    Of missschien uitslagen invullen van speelronde:
                    </br><input placeholder = 'round' v-model="roundThatHasBeen" min = 0 step =1/>
                    </br><button v-on:click="showMatches">Laat zien dan</button>
                    
                    </div>
            `,
            methods: {
                confirmTeam() {
                    if (!this.teamName) {
                        this.errorMessage = "wel team naam toevoegen";
                        return;
                    }

                    this.errorMessage = "";
                    this.$emit('team-confirmed', this.teamName);                 
                },
                confirmMatch() {
                    if (!this.homeTeam || !this.awayTeam) {
                        this.errorMessage = "wel team naam toevoegen";
                        return;
                    }

                    this.errorMessage = "";
                    this.$emit('match-confirmed', this.homeTeam, this.awayTeam, this.round);                 
                },
                showMatches() {
                    if (!this.roundThatHasBeen) {
                        this.errorMessage = "wel speelronde toevoegen";
                        return;
                    }
                    this.errorMessage = "";
                    this.$emit('show-matches', this.roundThatHasBeen);
                }
            }
        });

        Vue.component('links', {
            data() {
                return {
                }
            },
            template: `
                <div>
                    <button v-on:click="adminRights">admin</button>
                    <button v-on:click="getPlayedMatches">haal afgelopen potjes op</button>  
                    <button v-on:click="showPlayedMatches">laat afgelopen potjes zien</button>
                    <button v-on:click="showRegisterUser">Registreer</button>
                    <button v-on:click="showUserLogin">inloggen</button>
                    <button v-on:click="showMatchesToPredict">voorspel komende potjes</button>  
                    <button v-on:click="userLogOff">uitloggen</button> 
                </div>
                    
            `,
            methods: {   
                adminRights(){
                    this.$emit('admin-confirmed'); 
                },
                getPlayedMatches(){
                    this.$emit('get-played-matches'); 
                },
                showPlayedMatches(){
                    this.$emit('show-played-matches'); 
                },
                showRegisterUser(){
                    this.$emit('show-register-user'); 
                },
                showUserLogin(){
                    this.$emit('show-user-login'); 
                },
                showMatchesToPredict(){
                    this.$emit('show-matches-to-predict'); 
                },
                userLogOff(){
                    if(localStorage.length != 0){
                    localStorage.clear();
                    alert("k doei")
                    }
                }
            },
                
         });

         Vue.component('matches-screen', {
            props: [ 'playedMatches' ],
            data() {
                return {  
                       
                }
            },
            
            template: `
                <div>
                        <li v-for="match in playedMatches">
                            {{ match["homeTeam"] }} vs. {{ match["awayTeam"] }}&nbsp;&nbsp;
                            {{ match["homeGoals"] }}-{{ match["awayGoals"] }}
                        </li>
                </div>
            `,
            methods: {   
            }
         });
         

         Vue.component('fill-in-results-screen', {
            props: [ 'matches' ],
            data() {
                return {  
                       homeTeam: "",
                       awayTeam: "",
                       homeGoals: 0,
                       awayGoals: 0
                }
            },
            
            template: `
                <div>
                        <li v-for="match in matches">
                            <label>{{ match["homeTeam"] }}</label> 
                            <input v-model="homeGoals" min = 0 step =1 size="1">-
                            <input v-model="awayGoals" min = 0 step =1 size="1"> 
                            <label>{{ match["awayTeam"] }}</label>&nbsp;&nbsp;
                            <button v-on:click="sendMatchResults">Stort</button> 
                        </li>
                </div>
                    
            `,
            methods: { 
                sendMatchResults(){
                    console.log(event.target.parentNode.children[3].innerHTML)
                    this.$emit("give-results-to-matches", event.target.parentNode.children[0].innerHTML, event.target.parentNode.children[3].innerHTML, this.homeGoals, this.awayGoals)
                }  
            }
         });


         Vue.component('register-screen', {
            data() {
                return {  
                       userName: "",
                       password: "",
                       email:""
                }
            },
            
            template: `
                <div>
                    <input v-model="userName" placeholder ="user name" ></br>
                    <input v-model="password" placeholder ="password" type ="password"></br>
                    <input v-model="email" placeholder ="email" >
                    <button v-on:click="registerpls">Registreer</button>
                </div>
                    
            `,
            methods: { 
                registerpls(){
                    console.log()
                    this.$emit("register-user", this.userName, this.password, this.email)
                }  
            }
         });


         Vue.component('login-screen', {
            data() {
                return {  
                       userName: "",
                       password: "",
                       errorMessage: "",
                }
            },
            
            template: `
                <div>
                    <input v-model="userName" placeholder ="user name" ></br>
                    <input v-model="password" placeholder ="password" type ="password"></br>
                    <button v-on:click="logIn">Log in</button>

                    {{ errorMessage }}
                </div>
                    
            `,
            methods: { 
                logIn(){
                    console.log()
                    this.$emit("user-login", this.userName, this.password, this.errorMessage)
                }  
            }
         });

         Vue.component('predict-screen', {
            props: [ 'matchesToPredict' ],
            data() {
                return {  
                       homeGoals: undefined,
                       awayGoals: undefined,
                       homeTeam: undefined,
                       awayTeam: undefined,
                       ronde:false,
                       errorMessage:"",
                }
            },
            
            template: `
                <div>
                    <button v-on:click="startMatchPrediction">haal wedstrijden op</button>
                    </br></br>{{ errorMessage }}</br></br>
                    
                    <li v-for="match in matchesToPredict">
                            {{ match["round"] }}: <label>{{ match["homeTeam"] }}</label> 
                            <input v-model="homeGoals" min = 0 step =1 size="1">-
                            <input v-model="awayGoals" min = 0 step =1 size="1"> 
                            <label>{{ match["awayTeam"] }}</label>&nbsp;&nbsp;
                            <button v-on:click="sendPrediction">voorspel!</button>
                        </li>
                </div>
                    
            `,
            methods: { 
                startMatchPrediction(){
                    this.$emit("predict-matches")
                },
                sendPrediction(){
                    if(localStorage.length == 0){
                        this.errorMessage = "bennie ingelogd"
                    } else{
                        this.$emit("send-prediction", this.homeGoals, this.homeTeam, this.awayTeam, this.awayGoals, localStorage["username"])
                    }
                }    
            }
         });

    const app = new Vue({
        el: '#app',

        data: {
            haveAdminRights: false,
            showPlayed: false,
            matches: [],
            playedMatches: [],
            showMatchesForResult: false,
            showRegisterForm: false,
            showUserLogin: false, 
            predictMatches: false,
            matchesToPredict: [],
            errorMessage: "",
        },

        computed: {
            
        },
        methods: {
            hideAllScreens(){
                this.haveAdminRights=false;
                this.showPlayed=false;
                this.showMatchesForResult=false;
                this.predictMatches=false;
                this.showRegisterForm = false;
                this.showUserLogin= false;
                this.predictMatches = false;
            },
            async goToAdmin(){
                this.hideAllScreens();
                this.haveAdminRights= !this.haveAdminRights
                return this.haveAdminRights 
            },
            async goToRegister(){
                this.hideAllScreens();
                this.showRegisterForm= !this.showRegisterForm
                return this.showRegisterForm 
            },
            async goToLogin(){
                this.hideAllScreens();
                this.showUserLogin= !this.showUserLogin
                return this.showUserLogin 
            },
            async showPlayedMatchespls(){
                this.hideAllScreens();
                this.showPlayed= !this.showPlayed;
                return this.showPlayed; 
            },
            async goToPredictMatches(){
                this.hideAllScreens();
                this.predictMatches= !this.predictMatches;
                return this.predictMatches; 
            },
            async addTeam(teamName){
                console.log(teamName);
                let newTeam = {"teamName": teamName}
                await fetch('api/addTeam', {
                    method: 'POST',
                    headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(newTeam)  
                })
            },
            async addMatch(homeTeam, awayTeam, round){
                console.log(homeTeam + "" + awayTeam + "" + round);
                let newMatch = {
                    "homeTeam": homeTeam,
                    "awayTeam": awayTeam,
                    "round": round
            }
                await fetch('api/addMatch', {
                    method: 'POST',
                    headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(newMatch)  
                })
            },
            async getMatchesToGiveResult(roundThatHasBeen){
                let newRoundThatHasBeen= {"round": roundThatHasBeen}
                let response = await fetch('api/showMatch/', {
                    method: 'POST',
                    headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(newRoundThatHasBeen) 
                })
                let matches = await response.json();
                this.matches=matches;
                console.log(matches);
                this.showMatchesForResult= !this.showMatchesForResult;
                return this.showMatchesForResult; 
            },

            async getPlayedMatches(){
                let response = await fetch('/api/getPlayed/', {
                    method: 'GET',
                    headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                    },
                })
                playedMatches = await response.json();
                this.playedMatches=playedMatches;
                console.log(playedMatches);
            },
            async sendResults(homeTeam, awayTeam, homeGoals, awayGoals){
                let newMatchToGiveResult = {
                    "homeTeam": homeTeam,
                    "awayTeam": awayTeam,
                    "homeGoals": homeGoals,
                    "awayGoals": awayGoals
                 }
                let response = await fetch('/api/sendResults/', {
                    method: 'POST',
                    headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(newMatchToGiveResult)
                })
                playedMatches = await response.json();
                console.log(playedMatches);
            },
            async registerUser(userName, password, email){
                console.log(userName + "" + password + "" + email);
                let newUser = {
                    "userName": userName,
                    "password": password,
                    "email": email
            }
                await fetch('api/registerUser', {
                    method: 'POST',
                    headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(newUser)  
                })
            },
            async userLogin(userName, password){
                
                let newLogin= {
                    "userName": userName,
                    "password": password
                }
                let response = await fetch('api/userLogin', {
                    method: 'POST',
                    headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(newLogin) 
                })
                let userLoggingIn = await response.json()
                console.log(userLoggingIn)
                if(userLoggingIn !== "NEE"){
                    localStorage.setItem("username", userLoggingIn)
                }
                else{
                    console.log("flauwekul ingevuld")
                }
            },
            async showMatchesToPredict(){
                let response = await fetch('api/getMatchesToPredict/', {
                    method: 'GET',
                    headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                    },
                })
                matchesToPredict = await response.json();
                this.matchesToPredict = matchesToPredict;
                console.log(matchesToPredict);
            },
            async sendMatchPrediction(homeGoals, homeTeam, awayTeam, awayGoals, userName){
                let newPrediction = {
                    "homeGoals": homeGoals,
                    "awayGoals": awayGoals,
                    "homeTeam": homeTeam,
                    "awayTeam": awayTeam,
                    "userName": localStorage["username"]
                }
                await fetch('api/sendMatchPrediction/', {
                    method: 'POST',
                    headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(newPrediction)
                })
            },
        },  
    })            

    
    </script>
    </body>
</html>

